# IP探测工具 - 资产识别

一个基于Python的IP探测工具，用于高精度识别网络中的在线设备和资产，采用多重验证机制，有效避免误判，支持多种扫描方式和灵活的配置选项。

## 功能特点

### 核心功能
- **高精度扫描**：采用多重验证机制，避免误判，确保结果准确性
- **综合扫描方式**：结合ARP扫描、ping扫描和TCP SYN扫描，提高检测可靠性
- **MAC地址获取**：自动获取在线设备的MAC地址
- **资产识别**：精确识别网络中正在使用的IP和设备
- **状态分类**：
  - 在线：当前可以正常通信的设备（通过多重验证）
  - 离线：曾经在线过（有MAC记录）但当前不可达的设备
  - 未使用：从未使用过的IP地址

### 扫描性能
- **多线程支持**：1-100线程可调整，适应不同网络环境
- **高效扫描**：优先使用ARP扫描，速度快，资源占用低
- **智能重试**：ping扫描支持重试机制，减少网络波动影响
- **防止误判**：采用多重验证，解决"IP标注在线但实际无法连接"的问题

### 用户体验
- **现代化GUI界面**：简洁美观，操作直观，支持拉伸自适应
- **实时进度显示**：1-100%精确进度条，带百分比标签
- **结果排序**：
  - IP地址：按数字顺序排序（1-254）
  - 状态：按在线 > 离线 > 未使用顺序排序
  - 支持升序/降序切换
- **结果导出**：支持导出为Excel文件，文件名使用扫描的IP段
- **实时日志**：详细记录扫描过程和结果

## 支持的IP输入格式

- 单个IP：如 `192.168.1.1`
- IP范围：如 `192.168.1.1-20`
- 完整IP范围：如 `192.168.1.1-192.168.1.100`
- CIDR网段：如 `192.168.1.0/24`

## 安装方法

### 1. 安装Python
确保系统已安装Python 3.7或更高版本。

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

## 使用说明

### 运行工具
```bash
python ip_prober.py
```

### 基本操作
1. 在"IP地址或地址段"输入框中输入要探测的IP范围
2. 在"线程数"输入框中设置合适的线程数
3. 点击"开始探测"按钮启动扫描
4. 观察实时进度条和日志信息
5. 扫描过程中可以点击"停止探测"按钮中断扫描
6. 扫描完成后：
   - 点击列标题进行排序
   - 点击"导出结果"按钮将结果保存为Excel文件

### 线程数建议
- 小网络（<100个IP）：10-20线程
- 中等网络（100-1000个IP）：20-50线程
- 大网络（>1000个IP）：50-100线程
- 网络环境好时可适当增加线程数
- 网络环境差时建议减少线程数

## 导出文件

### 文件名格式
- 格式：`{IP段}_probe_result.xlsx`
- 例如：扫描 `192.168.1.1-20`，导出文件名为 `192.168.1.1-20_probe_result.xlsx`

### 导出内容
- IP地址：设备的IP地址
- 状态：在线/离线/未使用
- MAC地址：设备的物理地址

## 技术实现

### 扫描机制
1. **ARP扫描**：
   - 优先检查ARP缓存，但不盲目信任
   - 必须通过实际ARP请求（arping）验证
   - 只有同时满足"有MAC地址"和"ARP请求成功"才视为通过

2. **ping扫描**：
   - 对ARP扫描失败的IP进行ping扫描
   - 支持2次重试，提高可靠性
   - 防止网络波动导致的误判

3. **TCP SYN扫描**：
   - 对ARP和ping扫描失败的IP，扫描常用端口（80, 443, 22, 23, 3389, 21）
   - 只有端口真正开放（返回0）才视为通过
   - 移除了"端口关闭即视为在线"的错误逻辑
   - 增加超时时间到0.8秒，减少网络延迟影响

### 高精度验证机制
- **多重验证**：需要至少两种验证方式通过才视为在线
- **验证计数器**：记录通过的验证方式数量
- **二次验证**：对于只有一种验证通过的IP，增加二次确认机制
- **严格判断**：确保只有真正在线的设备才会被标记为"在线"

### 状态判断逻辑
- 如果**至少两种验证方式通过**，状态为"在线"
- 如果只有一种验证通过，进行二次验证，确认后才标记为"在线"
- 如果都失败但有MAC地址，状态为"离线"
- 如果都失败且没有MAC地址，状态为"未使用"

## 误判问题解决

### 问题描述
- 原始版本中可能出现"IP标注在线但实际无法连接"的误判情况
- 原因：单一验证机制过于宽松，ARP缓存不可靠，TCP SYN扫描判断条件不当

### 解决方案
1. **优化ARP扫描**：
   - 不再仅依赖ARP缓存
   - 增加实际ARP请求验证
   - 只有同时满足"有MAC地址"和"ARP请求成功"才视为通过

2. **收紧TCP SYN扫描判断**：
   - 只有端口真正开放（返回0）才视为通过
   - 移除了"端口关闭即视为在线"的错误逻辑
   - 增加超时时间到0.8秒

3. **引入多重验证机制**：
   - 需要至少两种验证方式通过才视为在线
   - 对于只有一种验证通过的IP，增加二次验证

4. **优化ping扫描**：
   - 增加重试机制，最多尝试2次
   - 提高ping扫描的可靠性

## 注意事项

1. **权限要求**：
   - 部分功能（如ARP扫描）可能需要管理员权限
   - 建议以管理员身份运行命令行或IDE

2. **网络环境**：
   - 工具主要用于局域网扫描
   - 跨网段扫描可能受到路由器或防火墙限制
   - 部分设备可能禁用ICMP或常用端口，影响探测结果

3. **结果解读**：
   - "在线"状态：设备当前可正常通信（通过多重验证）
   - "离线"状态：设备曾经在线过，但当前不可达
   - "未使用"状态：该IP从未被使用过
   - 结果具有高度可靠性，可放心参考

4. **性能优化**：
   - 大网络扫描时，建议适当减少线程数，避免网络拥堵
   - 长时间扫描时，建议定期保存结果

## 系统要求

- 操作系统：Windows 7/8/10/11
- Python版本：3.7或更高
- 依赖库：openpyxl

## 更新日志

### v1.1.0
- **核心优化**：实现多重验证机制，解决误判问题
- **ARP扫描优化**：增加实际ARP请求验证，不再仅依赖缓存
- **TCP SYN扫描优化**：只有端口开放才视为在线，移除错误逻辑
- **ping扫描优化**：增加重试机制，提高可靠性
- **进度条改进**：1-100%精确显示，带百分比标签
- **GUI美化**：现代化界面设计，提升用户体验
- **文档更新**：完善技术实现和误判问题解决方案说明

### v1.0.0
- 初始版本
- 支持ARP扫描、ping扫描和TCP SYN扫描
- 多线程支持
- GUI界面
- 结果排序和导出功能

## 许可证

本项目采用MIT许可证，可自由使用、修改和分发。

## 贡献

欢迎提交Issue和Pull Request，共同改进这个工具。

---

**使用说明**：
1. 确保已安装Python 3.7或更高版本
2. 安装依赖：`pip install -r requirements.txt`
3. 运行工具：`python ip_prober.py`
4. 在界面中输入IP范围，设置线程数，点击"开始探测"
5. 扫描完成后可对结果进行排序和导出

祝您使用愉快！
